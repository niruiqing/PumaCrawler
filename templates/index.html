<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PUMA商品信息查询</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin: 2rem auto;
            max-width: 1200px;
        }
        
        .header-section {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .header-section h1 {
            color: #333;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .header-section p {
            color: #666;
            font-size: 1.1rem;
        }
        
        .input-section {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .url-input {
            border: 2px solid #e3e3e3;
            border-radius: 10px;
            padding: 1rem;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }
        
        .url-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        
        .url-input.placeholder-style {
            color: #999;
            font-style: italic;
        }
        
        .url-input.user-input {
            color: #333;
            font-style: normal;
        }
        
        .search-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 10px;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        
        .loading-section {
            text-align: center;
            padding: 3rem;
            display: none;
        }
        
        .spinner-border {
            width: 3rem;
            height: 3rem;
        }
        
        .product-section {
            display: none;
            animation: fadeInUp 0.6s ease;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .product-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
        }
        
        .product-header {
            border-bottom: 2px solid #f8f9fa;
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .product-title {
            color: #333;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .product-subtitle {
            color: #666;
            font-size: 1.1rem;
        }
        
        .price-tag {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-weight: 600;
            display: inline-block;
            margin: 0.25rem;
        }
        
        .size-badge {
            background: #28a745;
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            margin: 0.2rem;
            display: inline-block;
            font-size: 0.9rem;
        }
        
        .size-badge.unavailable {
            background: #dc3545;
        }
        
        .image-gallery {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .product-image {
            width: 100%;
            max-width: 200px;
            height: auto;
            border-radius: 10px;
            margin: 0.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .product-image:hover {
            transform: scale(1.05);
        }
        
        .info-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .info-title {
            color: #333;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }
        
        .info-title i {
            margin-right: 0.5rem;
            color: #667eea;
        }
        
        .error-alert {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .success-alert {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        /* 新增：KEY:VALUE显示样式 */
        .key-value-display {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 15px;
            line-height: 1.6;
        }
        
        .key-value-display pre {
            margin: 0;
            padding: 0;
            background: none;
            border: none;
            font-family: inherit;
            font-size: inherit;
            color: #333;
        }
        
        /* JSON显示特殊样式 */
        .json-display {
            background: #263238;
            color: #ffffff;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.5;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #37474f;
        }
        
        .json-display pre {
            margin: 0;
            padding: 0;
            background: none;
            border: none;
            color: inherit;
            font-family: inherit;
            font-size: inherit;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-container">
            <!-- 头部区域 -->
            <div class="header-section">
                <h1>PUMA商品信息抓取</h1>
                <p>输入PUMA商品页面地址</p>
            </div>
            
            <!-- 输入区域 -->
            <div class="input-section">
                <div class="row">
                    <div class="col-md-9">
                        <input type="url" 
                               id="productUrl" 
                               class="form-control url-input placeholder-style" 
                               placeholder="请输入PUMA商品页面URL"
                               value="">
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-primary search-btn w-100" onclick="searchProduct()">
                            <i class="fas fa-search"></i> 查询商品
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 加载区域 -->
            <div class="loading-section" id="loadingSection">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <h4 class="mt-3">正在获取商品信息...</h4>
            </div>
            
            <!-- 错误提示区域 -->
            <div id="errorSection"></div>
            
            <!-- 商品信息区域 -->
            <div class="product-section" id="productSection">
                <!-- 完整商品信息展示 -->
                <div class="product-card">
                    <h4 class="info-title">
                        <i class="fas fa-info-circle"></i>
                        商品完整信息
                    </h4>
                    <div id="fullProductInfo" class="key-value-display">
                        <!-- 完整商品信息将在这里以KEY:VALUE格式显示 -->
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 默认示例URL
        const defaultUrl = 'https://us.puma.com/us/en/pd/deviate-nitro-3-womens-running-shoes/309708?swatch=04';
        const urlInput = document.getElementById('productUrl');
        
        // 设置默认显示
        urlInput.value = defaultUrl;
        urlInput.classList.add('placeholder-style');
        
        // 输入框点击事件 - 清空内容
        urlInput.addEventListener('click', function() {
            if (this.classList.contains('placeholder-style')) {
                this.value = '';
                this.classList.remove('placeholder-style');
                this.classList.add('user-input');
            }
        });
        
        // 输入框失去焦点事件 - 如果为空则恢复默认
        urlInput.addEventListener('blur', function() {
            if (this.value.trim() === '') {
                this.value = defaultUrl;
                this.classList.remove('user-input');
                this.classList.add('placeholder-style');
            }
        });
        
        // 输入事件 - 用户开始输入时移除placeholder样式
        urlInput.addEventListener('input', function() {
            if (this.classList.contains('placeholder-style')) {
                this.classList.remove('placeholder-style');
                this.classList.add('user-input');
            }
        });
        
        async function searchProduct() {
            const urlInput = document.getElementById('productUrl');
            let url = urlInput.value.trim();
            
            // 如果是placeholder状态或为空，使用默认URL
            if (!url || urlInput.classList.contains('placeholder-style')) {
                url = defaultUrl;
                // 更新输入框显示为用户输入状态
                urlInput.value = url;
                urlInput.classList.remove('placeholder-style');
                urlInput.classList.add('user-input');
            }
            
            if (!url.toLowerCase().includes('puma.com')) {
                showError('请输入有效的PUMA商品页面URL');
                return;
            }
            
            // 显示加载状态
            showLoading();
            
            try {
                const response = await fetch('/api/scrape', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url: url })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showProduct(data.product);
                } else {
                    showError(data.error || '获取商品信息失败');
                }
            } catch (error) {
                console.error('请求错误:', error);
                showError('网络请求失败，请检查网络连接');
            } finally {
                hideLoading();
            }
        }
        
        function showLoading() {
            document.getElementById('loadingSection').style.display = 'block';
            document.getElementById('productSection').style.display = 'none';
            document.getElementById('errorSection').innerHTML = '';
        }
        
        function hideLoading() {
            document.getElementById('loadingSection').style.display = 'none';
        }
        
        function showError(message) {
            const errorHtml = `
                <div class="error-alert">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>错误：</strong> ${message}
                </div>
            `;
            document.getElementById('errorSection').innerHTML = errorHtml;
            document.getElementById('productSection').style.display = 'none';
        }
        
        function showProduct(product) {
            document.getElementById('errorSection').innerHTML = '';
            
            // 整版商品信息以KEY:VALUE格式显示
            let fullProductInfoText = '';
            
            // =================================================================
            // 基本信息
            // =================================================================
            if (product.basic_info) {
                fullProductInfoText += '=== 基本信息 ===\n';
                if (product.basic_info.navigation_path) fullProductInfoText += `商品路径: ${product.basic_info.navigation_path}\n`;
                if (product.basic_info.header) fullProductInfoText += `页面标题: ${product.basic_info.header}\n`;
                if (product.basic_info.sub_header) fullProductInfoText += `副标题: ${product.basic_info.sub_header}\n`;
                fullProductInfoText += `商品名称: ${product.basic_info.name || 'N/A'}\n`;
                fullProductInfoText += `品牌: ${product.basic_info.brand || 'N/A'}\n`;
                fullProductInfoText += `商品ID: ${product.basic_info.product_id || 'N/A'}\n`;
                if (product.basic_info.variant_id) fullProductInfoText += `变体ID: ${product.basic_info.variant_id}\n`;
                if (product.basic_info.sku) fullProductInfoText += `商品编码: ${product.basic_info.sku}\n`;
                if (product.basic_info.style_number) fullProductInfoText += `款式编号: ${product.basic_info.style_number}\n`;
                if (product.basic_info.ean) fullProductInfoText += `国际商品条码: ${product.basic_info.ean}\n`;
                if (product.basic_info.category) fullProductInfoText += `分类: ${product.basic_info.category}\n`;
                if (product.basic_info.subcategory) fullProductInfoText += `子分类: ${product.basic_info.subcategory}\n`;
                if (product.basic_info.primary_category_id) fullProductInfoText += `主分类ID: ${product.basic_info.primary_category_id}\n`;
                if (product.basic_info.product_division) fullProductInfoText += `产品部门: ${product.basic_info.product_division}\n`;
                if (product.basic_info.gender) fullProductInfoText += `性别: ${product.basic_info.gender}\n`;
                if (product.basic_info.age_group) fullProductInfoText += `年龄组: ${product.basic_info.age_group}\n`;
                fullProductInfoText += `可订购: ${product.basic_info.orderable ? 'true' : 'false'}\n`;
                if (product.basic_info.is_final_sale !== null && product.basic_info.is_final_sale !== undefined) {
                    fullProductInfoText += `最终销售: ${product.basic_info.is_final_sale ? 'true' : 'false'}\n`;
                }
                if (product.basic_info.valid_until) fullProductInfoText += `有效期至: ${product.basic_info.valid_until}\n`;
                if (product.basic_info.is_app_exclusive) fullProductInfoText += `应用独家: ${product.basic_info.is_app_exclusive ? 'true' : 'false'}\n`;
                if (product.basic_info.size_chart_id) fullProductInfoText += `尺码表ID: ${product.basic_info.size_chart_id}\n`;
                if (product.basic_info.description) fullProductInfoText += `商品描述: ${product.basic_info.description}\n`;
                fullProductInfoText += '\n';
            }
            
            // =================================================================
            // 价格信息
            // =================================================================
            if (product.price_info) {
                fullProductInfoText += '=== 价格信息 ===\n';
                if (product.price_info.price) fullProductInfoText += `当前价格: ${product.price_info.price}\n`;
                if (product.price_info.original_price) fullProductInfoText += `原价: ${product.price_info.original_price}\n`;
                if (product.price_info.sale_price) fullProductInfoText += `销售价格: ${product.price_info.sale_price}\n`;
                if (product.price_info.promotion_price) fullProductInfoText += `促销价格: ${product.price_info.promotion_price}\n`;
                if (product.price_info.best_price) fullProductInfoText += `最优价格: ${product.price_info.best_price}\n`;
                if (product.price_info.discount) fullProductInfoText += `折扣: ${product.price_info.discount}\n`;
                if (product.price_info.tax) fullProductInfoText += `税费: ${product.price_info.tax}\n`;
                if (product.price_info.tax_rate) fullProductInfoText += `税率: ${product.price_info.tax_rate}\n`;
                fullProductInfoText += '\n';
            }
            
            // =================================================================
            // 颜色信息
            // =================================================================
            if (product.color_info) {
                fullProductInfoText += '=== 颜色信息 ===\n';
                if (product.color_info.name) fullProductInfoText += `颜色名称: ${product.color_info.name}\n`;
                if (product.color_info.value) fullProductInfoText += `颜色代码: ${product.color_info.value}\n`;
                fullProductInfoText += '\n';
            }
            
            // =================================================================
            // 当前SKU信息
            // =================================================================
            if (product.current_variation && Object.keys(product.current_variation).length > 0) {
                const variation = product.current_variation;
                fullProductInfoText += '=== 当前SKU信息 ===\n';
                if (variation.variantId) fullProductInfoText += `SKU ID: ${variation.variantId}\n`;
                if (variation.name) fullProductInfoText += `SKU名称: ${variation.name}\n`;
                if (variation.colorName) fullProductInfoText += `颜色名称: ${variation.colorName}\n`;
                if (variation.colorValue) fullProductInfoText += `颜色代码: ${variation.colorValue}\n`;
                if (variation.price) fullProductInfoText += `价格: ${variation.price}\n`;
                if (variation.salePrice) fullProductInfoText += `销售价格: ${variation.salePrice}\n`;
                if (variation.orderable !== undefined) fullProductInfoText += `可订购: ${variation.orderable ? 'true' : 'false'}\n`;
                if (variation.styleNumber) fullProductInfoText += `款式编号: ${variation.styleNumber}\n`;
                if (variation.ean) fullProductInfoText += `国际商品条码: ${variation.ean}\n`;
                if (variation.isFinalSale !== undefined) fullProductInfoText += `最终销售: ${variation.isFinalSale ? 'true' : 'false'}\n`;
                
                // SKU预览图
                if (variation.preview) {
                    fullProductInfoText += `SKU预览图: ${variation.preview}\n`;
                }
                
                // SKU图片
                if (variation.images && variation.images.length > 0) {
                    variation.images.forEach((imageUrl, imgIndex) => {
                        if (imageUrl) {
                            fullProductInfoText += `SKU图片${imgIndex + 1}: ${imageUrl}\n`;
                        }
                    });
                }
                
                // SKU徽章
                if (variation.badges && variation.badges.length > 0) {
                    variation.badges.forEach((badge, badgeIndex) => {
                        if (badge) {
                            fullProductInfoText += `徽章${badgeIndex + 1}: ${badge}\n`;
                        }
                    });
                }
                
                // 注意：原始HTML和纯文本的longDescription已移除，只保留解析后的结构化内容
                
                // 展示解析后的结构化内容
                if (variation.parsed_long_description && Object.keys(variation.parsed_long_description).length > 0) {
                    fullProductInfoText += `\n=== SKU详细产品故事 ===\n`;
                    
                    for (const [sectionTitle, sectionData] of Object.entries(variation.parsed_long_description)) {
                        fullProductInfoText += `\n**${sectionTitle}**\n`;
                        
                        // 显示文本内容
                        if (sectionData.text) {
                            fullProductInfoText += `${sectionData.text}\n`;
                        }
                        
                        // 显示列表项
                        if (sectionData.list_items && sectionData.list_items.length > 0) {
                            sectionData.list_items.forEach((item, index) => {
                                fullProductInfoText += `  ${index + 1}. ${item}\n`;
                            });
                        }
                    }
                }
                
                fullProductInfoText += '\n';
            }
            
            // =================================================================
            // 尺码信息
            // =================================================================
            if (product.sizes) {
                fullProductInfoText += '=== 尺码信息 ===\n';
                if (product.sizes.stats) {
                    fullProductInfoText += `总尺码数: ${product.sizes.stats.total}\n`;
                    fullProductInfoText += `可用尺码数: ${product.sizes.stats.available}\n`;
                    fullProductInfoText += `不可用尺码数: ${product.sizes.stats.unavailable}\n`;
                }
                
                if (product.sizes.all_sizes && product.sizes.all_sizes.length > 0) {
                    fullProductInfoText += '所有尺码: ' + product.sizes.all_sizes.join(', ') + '\n';
                }
                
                if (product.sizes.available_sizes && product.sizes.available_sizes.length > 0) {
                    fullProductInfoText += '可用尺码: ' + product.sizes.available_sizes.join(', ') + '\n';
                }
                
                if (product.sizes.unavailable_sizes && product.sizes.unavailable_sizes.length > 0) {
                    fullProductInfoText += '不可用尺码: ' + product.sizes.unavailable_sizes.join(', ') + '\n';
                }
                fullProductInfoText += '\n';
            }
            
            // =================================================================
            // 尺码测量表
            // =================================================================
            if (product.metric_measurements && product.metric_measurements.length > 0) {
                fullProductInfoText += '=== 尺码测量表(公制) ===\n';
                product.metric_measurements.forEach((row, index) => {
                    if (Array.isArray(row)) {
                        fullProductInfoText += `公制测量${index}: ${row.join(' - ')}\n`;
                    }
                });
                fullProductInfoText += '\n';
            }
            
            if (product.imperial_measurements && product.imperial_measurements.length > 0) {
                fullProductInfoText += '=== 尺码测量表(英制) ===\n';
                product.imperial_measurements.forEach((row, index) => {
                    if (Array.isArray(row)) {
                        fullProductInfoText += `英制测量${index}: ${row.join(' - ')}\n`;
                    }
                });
                fullProductInfoText += '\n';
            }
            
            // =================================================================
            // 详细尺码组信息
            // =================================================================
            if (product.size_groups && product.size_groups.length > 0) {
                fullProductInfoText += '=== 详细尺码组信息 ===\n';
                product.size_groups.forEach((group, groupIndex) => {
                    if (group.label) {
                        fullProductInfoText += `尺码组${groupIndex + 1}名称: ${group.label}\n`;
                    }
                    if (group.description) {
                        fullProductInfoText += `尺码组${groupIndex + 1}描述: ${group.description}\n`;
                    }
                    if (group.sizes && group.sizes.length > 0) {
                        group.sizes.forEach((size, sizeIndex) => {
                            const orderable = size.orderable ? '可购买' : '不可购买';
                            fullProductInfoText += `尺码${groupIndex + 1}-${sizeIndex + 1}: ${size.label} (${orderable})\n`;
                        });
                    }
                });
                fullProductInfoText += '\n';
            }
            
            // =================================================================
            // 图片信息（分离主要图片和SKU图片）
            // =================================================================
            
            // 主要产品图片（不显示，避免与SKU图片重复）
            // if (product.main_images && product.main_images.length > 0) {
            //     fullProductInfoText += '=== 主要产品图片 ===\n';
            //     product.main_images.forEach((imageUrl, index) => {
            //         fullProductInfoText += `主要图片${index + 1}: ${imageUrl}\n`;
            //     });
            //     fullProductInfoText += '\n';
            // }
            
            // 当前SKU图片（不显示，避免信息重复）
            // if (product.sku_images && product.sku_images.length > 0) {
            //     product.sku_images.forEach((imageUrl, index) => {
            //         fullProductInfoText += `SKU图片${index + 1}: ${imageUrl}\n`;
            //     });
            // }
            
            // 如果没有分离的图片数据，使用原有的images字段（向后兼容）
            if ((!product.main_images || product.main_images.length === 0) && 
                (!product.sku_images || product.sku_images.length === 0) && 
                product.images && product.images.length > 0) {
                fullProductInfoText += '=== 图片链接 ===\n';
                product.images.forEach((imageUrl, index) => {
                    fullProductInfoText += `图片${index + 1}: ${imageUrl}\n`;
                });
                fullProductInfoText += '\n';
            }
            
            // =================================================================
            // 库存和评价信息
            // =================================================================
            if (product.availability) {
                fullProductInfoText += '=== 库存信息 ===\n';
                if (typeof product.availability === 'string') {
                    fullProductInfoText += `库存状态: ${product.availability}\n`;
                } else {
                    if (product.availability.status) fullProductInfoText += `库存状态: ${product.availability.status}\n`;
                    if (product.availability.stock_status) fullProductInfoText += `库存状态码: ${product.availability.stock_status}\n`;
                }
                fullProductInfoText += '\n';
            }
            
            if (product.ratings) {
                fullProductInfoText += '=== 评价信息 ===\n';
                if (product.ratings.average) fullProductInfoText += `平均评分: ${product.ratings.average}\n`;
                if (product.ratings.count) fullProductInfoText += `评价数量: ${product.ratings.count}\n`;
                fullProductInfoText += '\n';
            }
            
            // =================================================================
            // 材料和特性
            // =================================================================
            if (product.materials && product.materials.length > 0) {
                fullProductInfoText += '=== 材料组成 ===\n';
                product.materials.forEach((material, index) => {
                    fullProductInfoText += `材料${index + 1}: ${material}\n`;
                });
                fullProductInfoText += '\n';
            }
            
            if (product.features && product.features.length > 0) {
                fullProductInfoText += '=== 产品特性 ===\n';
                product.features.forEach((feature, index) => {
                    fullProductInfoText += `特性${index + 1}: ${feature}\n`;
                });
                fullProductInfoText += '\n';
            }
            
            if (product.care_instructions && product.care_instructions.length > 0) {
                fullProductInfoText += '=== 护理说明 ===\n';
                product.care_instructions.forEach((instruction, index) => {
                    fullProductInfoText += `护理${index + 1}: ${instruction}\n`;
                });
                fullProductInfoText += '\n';
            }
            
            if (product.tech_specs && Object.keys(product.tech_specs).length > 0) {
                fullProductInfoText += '=== 技术规格 ===\n';
                for (const [key, value] of Object.entries(product.tech_specs)) {
                    fullProductInfoText += `技术规格: ${value}\n`;
                }
                fullProductInfoText += '\n';
            }
            
            if (product.badges && product.badges.length > 0) {
                fullProductInfoText += '=== 商品徽章 ===\n';
                product.badges.forEach((badge, index) => {
                    fullProductInfoText += `徽章${index + 1}: ${badge}\n`;
                });
                fullProductInfoText += '\n';
            }
            

            
            
            const productInfoElement = document.getElementById('fullProductInfo');
            
            // 处理所有图片链接，让其可点击
            let htmlContent = fullProductInfoText;
            
            // 转义HTML特殊字符，但保留我们要添加的链接
            htmlContent = htmlContent.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            
            // 处理图片URL，将其转换为可点击的链接
            // 首先处理带编号的SKU图片（如SKU图片1、SKU图片2等）
            const skuNumberedRegex = /(SKU图片[0-9]+:\s*)(https?:\/\/[^\s\n]+)/gi;
            htmlContent = htmlContent.replace(skuNumberedRegex, (match, prefix, url) => {
                const cleanUrl = url.replace(/&amp;/g, '&').replace(/&lt;/g, '<').replace(/&gt;/g, '>');
                return `${prefix}<a href="${cleanUrl}" target="_blank" style="color: #0066cc; text-decoration: underline; word-break: break-all; font-weight: normal;">${cleanUrl}</a>`;
            });
            
            // 然后处理其他图片格式
            const imageUrlRegex = /((?:主要图片|图片|SKU预览图)\d*:\s*)(https?:\/\/[^\s\n]+\.(?:jpg|jpeg|png|gif|webp|avif)[^\s\n]*)/gi;
            htmlContent = htmlContent.replace(imageUrlRegex, (match, prefix, url) => {
                // 恢复URL中的HTML转义字符
                const cleanUrl = url.replace(/&amp;/g, '&').replace(/&lt;/g, '<').replace(/&gt;/g, '>');
                return `${prefix}<a href="${cleanUrl}" target="_blank" style="color: #0066cc; text-decoration: underline; word-break: break-all; font-weight: normal;">${cleanUrl}</a>`;
            });
            
            // 处理SKU预览图
            const previewImageRegex = /(SKU预览图:\s*)(https?:\/\/[^\s\n]+)/gi;
            htmlContent = htmlContent.replace(previewImageRegex, (match, prefix, url) => {
                const cleanUrl = url.replace(/&amp;/g, '&').replace(/&lt;/g, '<').replace(/&gt;/g, '>');
                return `${prefix}<a href="${cleanUrl}" target="_blank" style="color: #0066cc; text-decoration: underline; word-break: break-all; font-weight: normal;">${cleanUrl}</a>`;
            });
            
            // 处理不带编号的SKU图片
            const skuImageRegex = /(SKU图片:\s*)(https?:\/\/[^\s\n]+)/gi;
            htmlContent = htmlContent.replace(skuImageRegex, (match, prefix, url) => {
                const cleanUrl = url.replace(/&amp;/g, '&').replace(/&lt;/g, '<').replace(/&gt;/g, '>');
                return `${prefix}<a href="${cleanUrl}" target="_blank" style="color: #0066cc; text-decoration: underline; word-break: break-all; font-weight: normal;">${cleanUrl}</a>`;
            });
            
            // 显示处理后的内容
            productInfoElement.innerHTML = `<pre style="white-space: pre-wrap; word-wrap: break-word;">${htmlContent}</pre>`;
            

            
            // 显示产品区域
            document.getElementById('productSection').style.display = 'block';
        }
        
        // 允许回车键触发搜索
        document.getElementById('productUrl').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchProduct();
            }
        });
    </script>
</body>
</html>